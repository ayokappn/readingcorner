/* ============================
   Digital Library – styles.css
   Premium mobile UI (DM Sans)
   ============================ */

/* ---------- Variables & reset ---------- */
:root{
  --bg-grad-1:#f3f3f6;
  --bg-grad-2:#e9ebef;
  --ink:#1f1f1f;
  --muted:#666;
  --line:#d9d9de;

  /* pastels doux pour segments */
  --col-citation:#cfd9ff;
  --col-commentaire:#cdefff;
  --col-bookmark:#d8f7d0;

  /* boutons / accents */
  --btn:#171717;
  --btn-ink:#ffffff;

  /* radius */
  --r-xs:10px;
  --r-s:12px;
  --r-m:16px;
  --r-l:20px;

  /* blur */
  --blur:14px;
}

/* iOS safe areas + 100dvh fiable */
:root { --vh: 1vh; } /* sera mis à jour en JS */
html { -webkit-text-size-adjust: 100%; touch-action: manipulation; }
body { min-height: 100dvh; }

/* Chaque page occupe 100% de l'écran et respecte l'encoche & la barre d'accueil */
.page{
  min-height: calc(var(--vh, 1vh) * 100);
  padding-top: calc(16px + env(safe-area-inset-top));
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
}

/* FAB au-dessus de la barre d'accueil */
.fab{ right: 18px; bottom: calc(18px + env(safe-area-inset-bottom)); }

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; }
body{
  margin:0;
  font-family: 'DM Sans', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--ink);
  background: linear-gradient(160deg, var(--bg-grad-1), var(--bg-grad-2));
}

/* helpers */
.hidden { display:none !important; }
.center { display:grid; place-items:center; }

/* glassmorphism utility */
.glass{
  background: rgba(255,255,255,.62);
  border: 1px solid rgba(255,255,255,.35);
  border-radius: var(--r-m);
  -webkit-backdrop-filter: blur(var(--blur));
  backdrop-filter: blur(var(--blur));
}

/* ---------- Page shells ---------- */
.page{ display:none; padding: 16px; }
.page.active{ display:block; }

/* ---------- Top bars & headers ---------- */
.top-bar{
  display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap;
  margin-bottom: 14px;
}
.top-bar h1{ margin:0; font-size: 20px; font-weight:700; }

.book-page-header{
  display:flex; flex-direction:column; align-items:flex-start; gap:8px;
  margin-bottom: 10px;
}
.book-page-header h1{
  margin:0; font-size: 22px; font-weight: 800; text-transform: uppercase; letter-spacing:.4px;
}
.book-page-header p{
  margin:0; font-size: 13px; text-transform: uppercase; color:#515151; letter-spacing:.6px;
}
.header-actions{ display:flex; gap:8px; flex-wrap:wrap; }

/* ---------- Controls, inputs, buttons ---------- */
.list-controls{
  display:flex; gap:8px; align-items:center; margin-bottom: 8px; flex-wrap:wrap;
}

input, select, textarea, button{
  font-family: inherit;
  font-size: 16px; /* >=16px = pas de zoom iOS au focus */
}

input, select, textarea{
  width: 100%;
  padding: 10px 12px;
  border:1px solid #d7d7dc;
  border-radius: var(--r-s);
  background:#fff;
  color: var(--ink);
  outline: none;
}
input:focus, select:focus, textarea:focus{
  border-color:#b7b7ff;
  box-shadow: 0 0 0 3px rgba(110,125,255,.18);
}

.btn-outline{
  background: transparent;
  color: var(--ink);
  border: 1px solid var(--ink);
  border-radius: 999px;
  padding: 8px 14px;
  cursor: pointer;
}
.btn-outline:active{ transform: translateY(1px); }

.btn-primary{
  background: var(--btn);
  color: var(--btn-ink);
  border: none;
  border-radius: 999px;
  padding: 10px 16px;
  cursor: pointer;
}
.btn-primary:active{ transform: translateY(1px); }

/* ---------- Book list ---------- */
.book-list{ list-style:none; margin:0; padding:0; }
.book-list li{
  display:flex; align-items:center; justify-content:space-between;
  padding: 14px 0;
  border-bottom: 2px solid var(--line);
  max-width: 92%;
  margin: 0 auto;
}
.book-list li:last-child{ border-bottom: none; }
.book-list li span:first-child{ font-weight: 800; text-transform: uppercase; letter-spacing:.4px; }
.book-list li span:last-child{ text-transform: uppercase; color:#666; letter-spacing:.4px; }

/* ---------- Progress bar (élégante) ---------- */
.progress-wrap{ max-width: 560px; margin: 6px auto 12px; }
.progress-outer{
  border-radius: 999px;
  padding: 10px;
}
.progress-track{
  position: relative;
  height: 14px;
  border-radius: 999px;
  overflow: hidden;
  background: rgba(255,255,255,.66);
  border: 1px solid rgba(0,0,0,.06);
}
.progress-fill{
  position:absolute; inset:0;
  display:flex; /* accueille les segments */
}
.progress-seg{
  height:100%;
}
.progress-marks{ position:absolute; inset:0; pointer-events:auto; }
.progress-scale{
  display:flex; justify-content:space-between; font-size:12px; color:#8a8a8a; padding: 2px 4px 0;
}

/* marqueurs par type */
.progress-mark{
  position:absolute; bottom: 100%;
  width: 10px; height: 10px; border-radius: 50%;
  transform: translate(-50%, 2px);
  border: 1px solid rgba(0,0,0,.08);
  background: #fff;
}
.progress-mark.citation     { background: var(--col-citation); }
.progress-mark.commentaire  { background: var(--col-commentaire); }
.progress-mark.bookmark     { background: var(--col-bookmark); }
.progress-mark.question{
  background:#fff; border: 2px solid #ef5350; width: 14px; height: 14px;
}
.progress-mark.question::after{
  content:"?"; position:absolute; top:50%; left:50%;
  transform: translate(-50%,-50%); font-size: 10px; color:#ef5350; font-weight:800;
}

/* ---------- Stats panel ---------- */
.stats-panel{
  max-width:560px; margin: 12px auto 8px; padding: 0 4px;
  display:grid; grid-template-columns: 1fr 1fr; gap:10px;
}
.stat-card{
  padding: 14px 10px; text-align:center; cursor:pointer;
  transition: transform .06s ease, background .2s ease, border-color .2s ease;
}
.stat-card:active{ transform: translateY(1px); }
.stat-card[aria-pressed="true"]{ background: rgba(255,255,255,.82); border-color:#cfcfe8; }
.stat-number{ font-size: 28px; line-height:1; font-weight: 800; }
.stat-label{ margin-top: 2px; font-weight:700; letter-spacing:.6px; }

/* ---------- Annotation controls ---------- */
.annotations-controls{
  max-width: 560px; margin: 10px auto 8px; display:flex; justify-content:space-between; gap: 8px; align-items:center;
}

/* ---------- Annotations (cartes empilées décalées) ---------- */
.annotation-list{
  list-style:none; margin: 0 auto; padding:0; max-width: 560px;
}
.annotation-list.stacked li{
  position:relative;
  width: 92%;
  margin: 0 auto;
  margin-top: -14px;             /* chevauchement */
  background: rgba(255,255,255,.75);
  border: 1px solid rgba(0,0,0,.06);
  border-radius: 18px;
  -webkit-backdrop-filter: blur(var(--blur));
  backdrop-filter: blur(var(--blur));
  padding: 14px 14px 10px;
  transform: rotate(var(--rot, 0deg));
  transition: transform .18s ease, box-shadow .18s ease;
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
}
.annotation-list.stacked li:first-child{ margin-top: 0; }
.annotation-list.stacked li:nth-child(odd)  { --rot: -1.4deg; }
.annotation-list.stacked li:nth-child(even) { --rot:  1.2deg; }
.annotation-list.stacked li:active{ transform: rotate(0deg) scale(1.01); }

.annotation-type{
  font-size: 12px; font-weight:700; color: var(--muted); letter-spacing:.5px; text-transform: uppercase;
}
.annotation-text{
  font-size: 15px; line-height: 1.5; color: var(--ink); margin-top: 6px; word-break: break-word;
}
.annotation-page{
  font-size: 12px; color:#8a8a8a; text-align:right; margin-top: 8px;
}

/* ---------- Modals ---------- */
.modal{
  position: fixed; inset:0; display:none;
  background: rgba(0,0,0,.25);
  padding: 16px;
}
.modal.active{ display:flex; align-items:center; justify-content:center; }
.modal-content{
  width: min(560px, 94vw);
  padding: 14px;
  display:flex; flex-direction:column; gap:10px;
}
.modal-actions{ display:flex; gap:8px; justify-content:flex-end; }

/* fermer modales en cliquant dehors : géré en JS */

/* ---------- FAB (expendable) ---------- */
.fab{
  position: fixed; right: 18px; bottom: 18px; z-index: 50;
}
.fab-main{
  width:64px; height:64px; border-radius:50%;
  border: 1px solid rgba(255,255,255,.45);
  background:
    radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.9), rgba(255,255,255,.55)),
    linear-gradient(180deg, rgba(255,255,255,.45), rgba(255,255,255,.2));
  color:#111; font-weight:900;
  box-shadow: 0 16px 36px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.8);
  display:grid; place-items:center; font-size:28px; line-height:1; cursor:pointer;
  -webkit-backdrop-filter: blur(var(--blur)); backdrop-filter: blur(var(--blur));
  transition: transform .18s ease, box-shadow .18s ease;
  position: relative; overflow:hidden;
}
.fab-main::after{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(120% 60% at 50% -30%, rgba(255,255,255,.9), transparent 60%),
    radial-gradient(60% 60% at 50% 140%, rgba(255,255,255,.35), transparent 60%);
  pointer-events:none;
}

.fab.open .fab-main{ transform: rotate(45deg) scale(1.04); }

.fab-actions{
  position:absolute; right: 4px; bottom: 76px;
  display:flex; flex-direction:column; gap:10px;
  opacity:0; transform: translateY(10px); pointer-events:none;
  transition: opacity .2s ease, transform .2s ease;
}
.fab.open .fab-actions{ opacity:1; transform: translateY(0); pointer-events:auto; }

.fab-item{
  width:48px; height:48px; border-radius: 16px;
  background: rgba(255,255,255,.9);
  border: 1px solid rgba(0,0,0,.06);
  -webkit-backdrop-filter: blur(var(--blur)); backdrop-filter: blur(var(--blur));
  display:grid; place-items:center; font-size:22px; cursor:pointer;
  box-shadow: 0 8px 18px rgba(0,0,0,.12);
}
.fab-item:active{ transform: translateY(1px); }

/* ---------- Small screens fine-tune ---------- */
@media (max-width: 360px){
  .book-list li{ max-width: 96%; }
  .annotation-list.stacked li{ width: 96%; }
}

/* ---------- Accessibility focus (keyboard) ---------- */
button:focus-visible, .fab-item:focus-visible, .fab-main:focus-visible, .btn-outline:focus-visible, .btn-primary:focus-visible, select:focus-visible, input:focus-visible, textarea:focus-visible{
  outline: 3px solid rgba(110,125,255,.35);
  outline-offset: 2px;
}

/* ===== THEME GRADIENT ===== */
:root{
  --grad-a:#f6d3f1; /* défaut = rose */
  --grad-b:#fbe7f1;
}
body{
  background: linear-gradient(160deg, var(--grad-a), var(--grad-b));
}
body[data-theme="rose"]   { --grad-a:#f6d3f1; --grad-b:#fbe7f1; }
body[data-theme="rouge"]  { --grad-a:#ff9a9e; --grad-b:#fecfef; }
body[data-theme="bleu"]   { --grad-a:#a1c4fd; --grad-b:#c2e9fb; }
body[data-theme="vert"]   { --grad-a:#d4fc79; --grad-b:#96e6a1; }
body[data-theme="violet"] { --grad-a:#d3cce3; --grad-b:#e9e4f0; }

/* ===== GLASS SEARCH ===== */
.glass-input{
  background: rgba(255,255,255,.58);
  border: 1px solid rgba(255,255,255,.35);
  -webkit-backdrop-filter: blur(14px);
  backdrop-filter: blur(14px);
  border-radius: 999px;
  padding: 10px 14px;
}
.glass-input::placeholder{ color:#6b6b6b; }

/* ===== THEME PICKER (bottom-left) ===== */
.theme-picker{
  position: fixed; left: 16px; bottom: 16px; z-index: 60;
  display:flex; flex-direction:column; gap:8px; align-items:flex-start;
}
.theme-main{
  width:44px; height:44px; border-radius:12px; border:none;
  display:grid; place-items:center; font-size:20px; cursor:pointer;
}
.theme-sheet{
  display:none; padding:10px; border-radius:16px; gap:8px;
}
.theme-sheet.open{ display:flex; }
.theme-pill{
  width:36px; height:36px; border-radius:50%; border:1px solid rgba(0,0,0,.08);
  background: linear-gradient(135deg, var(--sw1), var(--sw2));
  cursor:pointer;
}
.theme-pill:active{ transform: translateY(1px); }

/* ===== 1) Dégradé premium (subtil, iOS-like) ===== */
:root{
  --grad-a:#efeaf6;
  --grad-b:#f7f0f7;
  --grad-spot-1:#ffd9e7;  /* petites lueurs */
  --grad-spot-2:#d8e9ff;
}
body{
  background:
    radial-gradient(40% 35% at 20% 20%, var(--grad-spot-1) 0%, transparent 60%),
    radial-gradient(45% 40% at 80% 30%, var(--grad-spot-2) 0%, transparent 60%),
    linear-gradient(160deg, var(--grad-a), var(--grad-b));
}

/* variantes de thème discrètes */
body[data-theme="rose"]   { --grad-a:#efeaf6; --grad-b:#f7f0f7; --grad-spot-1:#ffd9e7; --grad-spot-2:#d8e9ff; }
body[data-theme="rouge"]  { --grad-a:#f6e9eb; --grad-b:#f7e6e6; --grad-spot-1:#ffd0d3; --grad-spot-2:#ffe1ce; }
body[data-theme="bleu"]   { --grad-a:#eef3ff; --grad-b:#e8f5ff; --grad-spot-1:#cfe3ff; --grad-spot-2:#e3f3ff; }
body[data-theme="vert"]   { --grad-a:#eff8f0; --grad-b:#e9f6ee; --grad-spot-1:#d6f7d7; --grad-spot-2:#e8ffe8; }
body[data-theme="violet"] { --grad-a:#f1eef9; --grad-b:#f5f0fb; --grad-spot-1:#e5dcff; --grad-spot-2:#f0e8ff; }

/* ===== 2) Progress bar: marqueurs proportionnels ===== */
.progress-track{
  position:relative;
  height:12px;
  border-radius:999px;
  overflow:hidden;
  background: rgba(255,255,255,.6);
  border:1px solid rgba(0,0,0,.06);
}
.progress-fill{ display:none; } /* on n’utilise plus le fill continu */
.progress-marks{ position:absolute; inset:0; }
.progress-tick{
  position:absolute; top:3px; height:6px; border-radius:5px;
  transform:translateX(-50%);
}
/* couleurs par type (douces) */
.progress-tick[data-type="citation"]    { background:#cfd9ff; }
.progress-tick[data-type="commentaire"] { background:#cdefff; }
.progress-tick[data-type="bookmark"]    { background:#d8f7d0; }
.progress-tick[data-type="question"]    { background:#ffd6d6; border:1px solid #ef5350; }

/* ===== 3) Drop-downs & inputs en glass ===== */
select, .glass-input, input, textarea{
  background: rgba(255,255,255,.58);
  border: 1px solid rgba(255,255,255,.35);
  -webkit-backdrop-filter: blur(14px);
  backdrop-filter: blur(14px);
  border-radius: 12px;
}
select{
  appearance:none;
  background-image: linear-gradient(45deg, transparent 50%, #666 50%), linear-gradient(135deg, #666 50%, transparent 50%);
  background-position: calc(100% - 18px) calc(50% - 3px), calc(100% - 12px) calc(50% - 3px);
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-right:36px;
}

/* ===== 4) Boutons en glass/blur unifiés ===== */
.btn-outline, .btn-primary{
  background: rgba(255,255,255,.62);
  border:1px solid rgba(0,0,0,.08);
  color:#1f1f1f;
  -webkit-backdrop-filter: blur(14px);
  backdrop-filter: blur(14px);
  border-radius: 999px;
  padding: 10px 14px;
}
.btn-primary{ font-weight:600; }
.btn-outline:active, .btn-primary:active{ transform:translateY(1px); }

/* ===== 5) Liste d’accueil sans dividers ===== */
.book-list li{
  border-bottom:none !important;
  margin: 6px auto 10px;
  padding: 12px 0;
}

/* ===== 6) Cartes annotations — on enlève le “passe au-dessus” visuel ===== */
.annotation-list.stacked li{
  transition: transform .16s ease, box-shadow .16s ease;
}
.annotation-list.stacked li:active{
  transform: rotate(0deg) scale(1.01);
}

/* ===== 7) Cacher le bouton “+ Annotation” (on garde le FAB) ===== */
.annotations-controls #btn-add-annotation{ display:none !important; }

#input-text{
  min-height: 120px;
  resize: none;
  overflow: hidden; /* nécessaire pour l'auto-grow */
}

/* Les cartes stats héritent bien de la couleur du thème */
.stat-card{ color: var(--ink); }

/* Chiffres en badge "liquid glass" */
.stat-number{
  display: inline-block;
  font-size: 34px;  /* plus gros */
  font-weight: 900;
  line-height: 1;
  color: #111;      /* plus jamais bleu iOS */
  padding: 6px 12px;
  border-radius: 999px;
  background: rgba(255,255,255,.55);
  border: 1px solid rgba(255,255,255,.5);
  -webkit-backdrop-filter: blur(14px);
  backdrop-filter: blur(14px);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.7),
    inset 0 -8px 14px rgba(255,255,255,.35),
    0 8px 20px rgba(0,0,0,.08);
  position: relative;
}
.stat-number::after{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(120% 60% at 50% -30%, rgba(255,255,255,.6), transparent 60%),
    radial-gradient(60% 60% at 50% 140%, rgba(255,255,255,.25), transparent 60%);
  border-radius: inherit;
  pointer-events:none;
}
button { -webkit-appearance: none; appearance: none; color: inherit; }
.stat-card * { color: inherit; }